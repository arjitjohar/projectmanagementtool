version: 1
backend:
phases:
  build:
    commands:
      - npm ci --cache .npm --prefer-offline
      - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
frontend:
phases:
  prebuild:
    commands:
      - nvm install 23.7.0
      - nvm use 23.7.0
  build:
    commands:
      - npm run build
artifacts:
  baseDirectory: .next
  files:
    - '**/*'
cache:
  paths:
    - .next/cache/**/*
    - .npm/**/*
    - node_modules/**/*